(function(o,c){typeof exports=="object"&&typeof module<"u"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(o=typeof globalThis<"u"?globalThis:o||self,c(o["check-update"]={}))})(this,function(o){"use strict";const c=e=>{const n=new Blob(["("+e.toString()+")()"]),s=window.URL.createObjectURL(n),t=new Worker(s);return window.URL.revokeObjectURL(s),t},v=()=>{let e=1e4,n=1e3*60;const s=new RegExp(/<script(?:\s+[^>]*)?>(.*?)<\/script\s*>|<link(?:\s+[^>]*)?>(.*?)/gi);let t=`${location.origin}/index.html`,i,r=!1,d=!1;const p=async()=>{try{if(!t)return r=!0,"";const a=await fetch(`${t}?t=${Date.now()}`);if(a.status===200){const m=await a.text();return r=!1,m}else return r=!0,""}catch{return r=!0,""}},T=a=>(a==null?void 0:a.match(s))||[],b=()=>{clearInterval(i)};return self.onmessage=a=>{const{code:m,data:U}=a.data,{url:I=t,init:M=e,loop:C=n}=U||{};t=I,e=M,n=C,d=!0;const h=async()=>{const O=await p(),j=T(O);self.postMessage({sign:j,noCompare:r})};if(m==="pause")b();else{if(!d)return;setTimeout(async()=>{await h(),b(),i=setInterval(async()=>{await h()},n)},e)}},self},S=e=>{e.postMessage({code:"pause"}),e.terminate()};let l=null,u="last_signature";const w=localStorage.getItem(u);let f=w?JSON.parse(w):[],y=!1,g=()=>{console.log("The system version has been updated！")};const k=(e,n,s)=>{if(!window.navigator.onLine||y)return!1;const t=e.length,i=Array.from(new Set(e.concat(n)));if(t!==i.length){if(f=n,localStorage.setItem(u,JSON.stringify(f)),!t)return!1;s()}},L=({init:e,loop:n,cb:s=g,url:t,cacheKey:i=u})=>{u=i,g=s,l=c(v),l.postMessage({code:"start",data:{init:e,loop:n,url:t}}),l.onmessage=r=>{const{sign:d,noCompare:p}=r.data;y=p,k(f,d,g)}},R=e=>{var s,t;(((s=e.target)==null?void 0:s.visibilityState)||((t=e.target)==null?void 0:t.webkitVisibilityState))==="visible"?l.postMessage({code:"resume"}):l.postMessage({code:"pause"})};document.addEventListener("visibilitychange",R),o.cancelDetect=S,o.checkUpdate=L,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
