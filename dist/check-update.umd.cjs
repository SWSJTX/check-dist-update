(function(a,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(a=typeof globalThis<"u"?globalThis:a||self,i(a["check-update"]={}))})(this,function(a){"use strict";let i=1e4,d=1e3*60;const w=new RegExp(/<script(?:\s+[^>]*)?>(.*?)<\/script\s*>|<link(?:\s+[^>]*)?>(.*?)/gi);let o="last_signature";const h=localStorage.getItem(o);let g=h?JSON.parse(h):[];const v=`${location.origin}/index.html`;let y="",c,r=!1,m=!1;const S=async()=>{try{if(!y)return r=!0,"";const e=await fetch(`${y}?t=${Date.now()}`);if(e.status===200){const t=await e.text();return r=!1,t}else return r=!0,""}catch{return r=!0,""}},b=e=>(e==null?void 0:e.match(w))||[],T=async(e,t,n)=>{if(!window.navigator.onLine||r)return!1;const s=e.length,p=Array.from(new Set(e.concat(t)));if(s!==p.length){if(g=t,localStorage.setItem(o,JSON.stringify(g)),!s)return!1;n()}};let l=()=>{console.log("The system version has been updated！")};const u=async e=>{const t=await S(),n=b(t);await T(g,n,e)},f=()=>{c&&clearInterval(c)},I=({init:e=i,loop:t=d,cb:n=l,url:s=v,cacheKey:p=o})=>{y=s,o=p,l=n,i=e,d=t,m=!0,setTimeout(async()=>{await u(n),f(),c=setInterval(async()=>{await u(n)},t)},e)};document.addEventListener("visibilitychange",k);const k=e=>{var n,s;if(!m)return;(((n=e.target)==null?void 0:n.visibilityState)||((s=e.target)==null?void 0:s.webkitVisibilityState))!=="hidden"?setTimeout(async()=>{await u(l),f(),c=setInterval(async()=>{await u(l)},d)},i):f()};a.checkUpdate=I,a.clearTimer=f,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
