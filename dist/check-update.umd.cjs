(function(a,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(a=typeof globalThis<"u"?globalThis:a||self,i(a["check-update"]={}))})(this,function(a){"use strict";let i=1e4,f=1e3*60;const w=new RegExp(/<script(?:\s+[^>]*)?>(.*?)<\/script\s*>|<link(?:\s+[^>]*)?>(.*?)/gi);let o="last_signature";const h=localStorage.getItem(o);let d=h?JSON.parse(h):[];const v=`${location.origin}/index.html`;let g="",y,r=!1,m=!1;const b=async()=>{try{if(!g)return r=!0,"";const e=await fetch(`${g}?t=${Date.now()}`);if(e.status===200){const t=await e.text();return r=!1,t}else return r=!0,""}catch{return r=!0,""}},S=e=>(e==null?void 0:e.match(w))||[],T=async(e,t,n)=>{if(!window.navigator.onLine||r)return!1;const s=e.length,p=Array.from(new Set(e.concat(t)));if(s!==p.length){if(d=t,localStorage.setItem(o,JSON.stringify(d)),!s)return!1;n()}};let c=()=>{console.log("The system version has been updated！")};const l=async e=>{const t=await b(),n=S(t);await T(d,n,e)},u=()=>{clearInterval(y)},I=({init:e=i,loop:t=f,cb:n=c,url:s=v,cacheKey:p=o})=>{g=s,o=p,c=n,i=e,f=t,m=!0,setTimeout(async()=>{await l(n),u(),y=setInterval(async()=>{await l(n)},t)},e)};document.addEventListener("visibilitychange",k);const k=e=>{var n,s;if(!m)return;(((n=e.target)==null?void 0:n.visibilityState)||((s=e.target)==null?void 0:s.webkitVisibilityState))==="visible"?setTimeout(async()=>{await l(c),u(),y=setInterval(async()=>{await l(c)},f)},i):u()};a.checkUpdate=I,a.clearTimer=u,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
